{
  "info": {
    "name": "User Management API - RBAC Complete",
    "description": "API ƒë·∫ßy ƒë·ªß cho H·ªá th·ªëng Qu·∫£n l√Ω Ng∆∞·ªùi d√πng v·ªõi JWT Authentication, RBAC (Role-Based Access Control), Refresh Token, Avatar Upload, Password Reset, Activity Logs",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"user@test.com\",\n  \"password\": \"123456\",\n  \"role\": \"user\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi. Role c√≥ th·ªÉ l√†: user, admin, moderator"
          }
        },
        {
          "name": "Register Admin",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Admin User\",\n  \"email\": \"admin@test.com\",\n  \"password\": \"123456\",\n  \"role\": \"admin\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "ƒêƒÉng k√Ω t√†i kho·∫£n admin ƒë·ªÉ test RBAC"
          }
        },
        {
          "name": "Register Moderator",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Moderator User\",\n  \"email\": \"moderator@test.com\",\n  \"password\": \"123456\",\n  \"role\": \"moderator\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "ƒêƒÉng k√Ω t√†i kho·∫£n moderator ƒë·ªÉ test RBAC"
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.collectionVariables.set(\"accessToken\", jsonData.accessToken);",
                  "pm.collectionVariables.set(\"refreshToken\", jsonData.refreshToken);",
                  "pm.collectionVariables.set(\"userId\", jsonData.user.id || jsonData.user._id);",
                  "",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has accessToken\", function () {",
                  "    pm.expect(jsonData.accessToken).to.exist;",
                  "});",
                  "",
                  "pm.test(\"Response has refreshToken\", function () {",
                  "    pm.expect(jsonData.refreshToken).to.exist;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@test.com\",\n  \"password\": \"123456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "ƒêƒÉng nh·∫≠p v√† nh·∫≠n accessToken + refreshToken"
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.collectionVariables.set(\"accessToken\", jsonData.accessToken);",
                  "",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has new accessToken\", function () {",
                  "    pm.expect(jsonData.accessToken).to.exist;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "L√†m m·ªõi access token khi h·∫øt h·∫°n"
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            },
            "description": "ƒêƒÉng xu·∫•t - thu h·ªìi refresh token"
          }
        },
        {
          "name": "Logout All Devices",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/logout-all",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout-all"]
            },
            "description": "ƒêƒÉng xu·∫•t kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã - x√≥a t·∫•t c·∫£ refresh tokens"
          }
        }
      ]
    },
    {
      "name": "2. Profile (User)",
      "item": [
        {
          "name": "Get Profile",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/profile",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "profile"]
            },
            "description": "Xem th√¥ng tin profile c·ªßa ch√≠nh m√¨nh (C·∫ßn ƒëƒÉng nh·∫≠p)"
          }
        },
        {
          "name": "Update Profile",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Name\",\n  \"email\": \"updated@test.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/profile",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "profile"]
            },
            "description": "C·∫≠p nh·∫≠t th√¥ng tin profile"
          }
        }
      ]
    },
    {
      "name": "3. Admin - User Management (RBAC)",
      "item": [
        {
          "name": "Get All Users",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users"]
            },
            "description": "üìå CH·ªà ADMIN - L·∫•y danh s√°ch t·∫•t c·∫£ users\n\nTest ph√¢n quy·ªÅn:\n- Login v·ªõi admin ‚Üí 200 OK ‚úÖ\n- Login v·ªõi user ‚Üí 403 Forbidden ‚ùå"
          }
        },
        {
          "name": "Get User By ID",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}"]
            },
            "description": "üìå CH·ªà ADMIN - Xem th√¥ng tin chi ti·∫øt c·ªßa user"
          }
        },
        {
          "name": "Update User",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated User Name\",\n  \"email\": \"updated@test.com\",\n  \"role\": \"moderator\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}"]
            },
            "description": "üìå CH·ªà ADMIN - C·∫≠p nh·∫≠t th√¥ng tin user (bao g·ªìm c·∫£ role)"
          }
        },
        {
          "name": "Delete User",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}"]
            },
            "description": "üìå CH·ªà ADMIN - X√≥a user\n\nL∆∞u √Ω:\n- Kh√¥ng th·ªÉ x√≥a ch√≠nh m√¨nh\n- X√≥a user s·∫Ω x√≥a t·∫•t c·∫£ refresh tokens c·ªßa user ƒë√≥"
          }
        },
        {
          "name": "Toggle User Active Status",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"isActive\": false\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}/toggle-active",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}", "toggle-active"]
            },
            "description": "üìå CH·ªà ADMIN - K√≠ch ho·∫°t/v√¥ hi·ªáu h√≥a user\n\nKhi v√¥ hi·ªáu h√≥a (isActive: false):\n- User kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p\n- T·∫•t c·∫£ refresh tokens b·ªã x√≥a\n- User b·ªã logout kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã"
          }
        },
        {
          "name": "Get User Sessions",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}/sessions",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}", "sessions"]
            },
            "description": "üìå CH·ªà ADMIN - Xem t·∫•t c·∫£ sessions (refresh tokens) c·ªßa user\n\nResponse:\n- totalSessions: S·ªë l∆∞·ª£ng thi·∫øt b·ªã ƒëang ƒëƒÉng nh·∫≠p\n- sessions: Danh s√°ch refresh tokens v·ªõi th√¥ng tin device"
          }
        },
        {
          "name": "Delete User Sessions",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}/sessions",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}", "sessions"]
            },
            "description": "üìå CH·ªà ADMIN - X√≥a t·∫•t c·∫£ sessions c·ªßa user\n\nK·∫øt qu·∫£: User b·ªã logout kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã"
          }
        }
      ]
    },
    {
      "name": "4. Moderator (RBAC)",
      "item": [
        {
          "name": "Get All Users (Read-only)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/moderator/users",
              "host": ["{{baseUrl}}"],
              "path": ["moderator", "users"]
            },
            "description": "üìå ADMIN + MODERATOR - Xem danh s√°ch users (ch·ªâ xem, kh√¥ng ch·ªânh s·ª≠a)\n\nTest ph√¢n quy·ªÅn:\n- Login v·ªõi admin ‚Üí 200 OK ‚úÖ\n- Login v·ªõi moderator ‚Üí 200 OK ‚úÖ\n- Login v·ªõi user ‚Üí 403 Forbidden ‚ùå"
          }
        },
        {
          "name": "Get User By ID (Read-only)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/moderator/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["moderator", "users", "{{userId}}"]
            },
            "description": "üìå ADMIN + MODERATOR - Xem chi ti·∫øt user (read-only)"
          }
        }
      ]
    },
    {
      "name": "5. Activity Logs (Admin Only)",
      "item": [
        {
          "name": "Get Logs (All)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/logs?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["logs"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "üìå CH·ªà ADMIN - Xem t·∫•t c·∫£ activity logs v·ªõi pagination"
          }
        },
        {
          "name": "Get Logs (Filter by User)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/logs?userId={{userId}}&page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["logs"],
              "query": [
                {
                  "key": "userId",
                  "value": "{{userId}}"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "üìå CH·ªà ADMIN - L·ªçc logs theo User ID"
          }
        },
        {
          "name": "Get Logs (Filter by Action)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/logs?action=login&page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["logs"],
              "query": [
                {
                  "key": "action",
                  "value": "login"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "üìå CH·ªà ADMIN - L·ªçc logs theo Action (login, logout, register, update, delete...)"
          }
        },
        {
          "name": "Delete Old Logs",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"olderThan\": 30\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/logs",
              "host": ["{{baseUrl}}"],
              "path": ["logs"]
            },
            "description": "üìå CH·ªà ADMIN - X√≥a logs c≈© h∆°n N ng√†y"
          }
        }
      ]
    },
    {
      "name": "6. Test RBAC Scenarios",
      "item": [
        {
          "name": "‚ùå User calls Admin API (Should Fail)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users"]
            },
            "description": "‚ùå TEST FAIL CASE\n\n1. Login v·ªõi user@test.com\n2. G·ªçi API n√†y\n3. Expected: 403 Forbidden\n4. Message: \"Ch·ªâ admin m·ªõi c√≥ quy·ªÅn truy c·∫≠p\""
          }
        },
        {
          "name": "‚úÖ Admin calls Admin API (Should Success)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users"]
            },
            "description": "‚úÖ TEST SUCCESS CASE\n\n1. Login v·ªõi admin@test.com\n2. G·ªçi API n√†y\n3. Expected: 200 OK\n4. Response: [...danh s√°ch users...]"
          }
        },
        {
          "name": "‚úÖ Moderator calls Moderator API (Should Success)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/moderator/users",
              "host": ["{{baseUrl}}"],
              "path": ["moderator", "users"]
            },
            "description": "‚úÖ TEST SUCCESS CASE\n\n1. Login v·ªõi moderator@test.com\n2. G·ªçi API n√†y\n3. Expected: 200 OK\n4. Response: [...danh s√°ch users...] (read-only)"
          }
        },
        {
          "name": "‚ùå Moderator calls Admin API (Should Fail)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users"]
            },
            "description": "‚ùå TEST FAIL CASE\n\n1. Login v·ªõi moderator@test.com\n2. G·ªçi API n√†y\n3. Expected: 403 Forbidden\n4. Message: \"Ch·ªâ admin m·ªõi c√≥ quy·ªÅn truy c·∫≠p\""
          }
        },
        {
          "name": "‚ùå No Token (Should Fail)",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users"]
            },
            "description": "‚ùå TEST UNAUTHORIZED CASE\n\n1. Kh√¥ng g·ª≠i token\n2. G·ªçi API n√†y\n3. Expected: 401 Unauthorized\n4. Message: \"No token provided\""
          }
        }
      ]
    }
  ]
}
